<!DOCTYPE html>
<html>
<head>
<title>Admin Dashboard - QuestVoyage</title>

<style>

body{
margin:0;
font-family:Arial;
background:#f4f6fb;
}

/* HEADER */
header{
background:linear-gradient(135deg,#667eea,#764ba2);
color:white;
padding:15px 25px;
display:flex;
justify-content:space-between;
align-items:center;
}

header button{
background:red;
border:none;
color:white;
padding:8px 15px;
border-radius:5px;
cursor:pointer;
}

/* DASHBOARD */
.dashboard{
padding:30px;
}

/* CARDS */
.cards{
display:flex;
gap:20px;
flex-wrap:wrap;
}

.card{
flex:1;
min-width:220px;
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

.card h3{
margin:0;
color:#555;
}

.card p{
font-size:22px;
font-weight:bold;
margin-top:10px;
}

/* TABLE */
.table-container{
margin-top:30px;
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:10px;
border-bottom:1px solid #ddd;
text-align:left;
}

th{
background:#eef2ff;
}

button.cancel{
background:#1565c0;
color:white;
border:none;
padding:6px 10px;
border-radius:5px;
cursor:pointer;
}

/* SAVE SECTION */
.save-section{
margin-top:40px;
background:white;
padding:20px;
border-radius:10px;
text-align:center;
box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

.save-btn{
padding:12px 25px;
margin:10px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:bold;
}

.green{background:#4caf50;color:white;}
.orange{background:#ff9800;color:white;}

.save-message{
margin-top:10px;
display:none;
padding:10px;
border-radius:6px;
}

</style>
</head>

<body>

<header>
<h2>Admin Dashboard</h2>
<button onclick="adminLogout()">Logout</button>
</header>

<div class="dashboard">

<div class="cards">
<div class="card">
<h3>Total Bookings</h3>
<p id="totalBookings">0</p>
</div>

<div class="card">
<h3>Total Revenue</h3>
<p id="totalRevenue">â‚¹0</p>
</div>

<div class="card">
<h3>Total Wishlist Items</h3>
<p id="totalWishlist">0</p>
</div>
</div>


<div class="table-container">
<h3>All Bookings</h3>

<table>
<thead>
<tr>
<th>Booking ID</th>
<th>User</th>
<th>Package</th>
<th>Members</th>
<th>Total</th>
<th>Action</th>
</tr>
</thead>

<tbody id="bookingTable"></tbody>

</table>
</div>


<div class="save-section">
<h3>ðŸ’¾ Save Progress</h3>

<button class="save-btn green"
onclick="saveProgress()">
Save All Data
</button>

<button class="save-btn orange"
onclick="downloadBackup()">
Download Backup
</button>

<div id="saveMessage"
class="save-message"></div>

</div>

</div>

<script>

/* ================= ADMIN PROTECTION ================= */
if(localStorage.getItem("adminLoggedIn")!=="true"){
window.location.href="login.html";
}


/* ================= LOAD DASHBOARD ================= */
function loadDashboard(){

const bookings =
JSON.parse(localStorage.getItem("bookingHistory")) || [];

const users =
JSON.parse(localStorage.getItem("users")) || [];

let totalRevenue=0;
let totalWishlist=0;

const table=
document.getElementById("bookingTable");

table.innerHTML="";

/* BOOKINGS */
bookings.forEach((booking,index)=>{

totalRevenue += booking.total || 0;

table.innerHTML+=`
<tr>
<td>${booking.bookingId || "-"}</td>
<td>${booking.email || "-"}</td>
<td>${booking.package}</td>
<td>${booking.members}</td>
<td>â‚¹${booking.total || 0}</td>
<td>
<button class="cancel"
onclick="cancelBooking(${index})">
Cancel
</button>
</td>
</tr>`;
});

document.getElementById("totalBookings")
.innerText=bookings.length;

document.getElementById("totalRevenue")
.innerText="â‚¹"+totalRevenue;


/* WISHLIST COUNT FROM ALL USERS */
users.forEach(user=>{

const list=
JSON.parse(
localStorage.getItem(
"wishlist_"+user.email
)
)||[];

totalWishlist+=list.length;

});

document.getElementById("totalWishlist")
.innerText=totalWishlist;

}


/* ================= CANCEL BOOKING ================= */
function cancelBooking(index){

let bookings =
JSON.parse(localStorage.getItem("bookingHistory")) || [];

/* booking to remove */
const removedBooking = bookings[index];

/* remove from admin list */
bookings.splice(index,1);

localStorage.setItem(
"bookingHistory",
JSON.stringify(bookings)
);

/* ================= REMOVE FROM USER HISTORY ================= */

const userEmail = removedBooking.email;

let userBookings =
JSON.parse(
localStorage.getItem("booking_"+userEmail)
) || [];

/* remove same booking */
userBookings =
userBookings.filter(b =>
b.bookingId !== removedBooking.bookingId
);

localStorage.setItem(
"booking_"+userEmail,
JSON.stringify(userBookings)
);

/* reload dashboard */
loadDashboard();

alert("Booking Cancelled Successfully âœ…");
}
/* ================= SAVE BACKUP ================= */
function saveProgress(){

const backup={
users:JSON.parse(localStorage.getItem("users"))||[],
bookingHistory:
JSON.parse(localStorage.getItem("bookingHistory"))||[],
savedAt:new Date().toLocaleString()
};

localStorage.setItem(
"adminBackup",
JSON.stringify(backup)
);

showMessage("âœ… Data Saved Successfully","#d4edda","#155724");
}


/* ================= DOWNLOAD ================= */
function downloadBackup(){

const backup=
localStorage.getItem("adminBackup");

if(!backup){
alert("No backup available");
return;
}

const blob=
new Blob([backup],
{type:"application/json"});

const link=
document.createElement("a");

link.href=
URL.createObjectURL(blob);

link.download=
"QuestVoyage_Backup.json";

link.click();

showMessage("ðŸ“¥ Backup Downloaded",
"#cfe2ff","#084298");
}


/* ================= MESSAGE ================= */
function showMessage(text,bg,color){

const msg=
document.getElementById("saveMessage");

msg.style.display="block";
msg.style.background=bg;
msg.style.color=color;
msg.innerText=text;

setTimeout(()=>{
msg.style.display="none";
},4000);
}


/* ================= LOGOUT ================= */
function adminLogout(){
localStorage.removeItem("adminLoggedIn");
window.location.href="login.html";
}


/* AUTO UPDATE */
window.addEventListener("storage",loadDashboard);

loadDashboard();

</script>

</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Admin Dashboard - QuestVoyage</title>

<style>

body{
margin:0;
font-family:Arial;
background:#f4f6fb;
}

/* HEADER */
header{
background:linear-gradient(135deg,#667eea,#764ba2);
color:white;
padding:15px 25px;
display:flex;
justify-content:space-between;
align-items:center;
}

header button{
background:red;
border:none;
color:white;
padding:8px 15px;
border-radius:5px;
cursor:pointer;
}

.dashboard{
padding:30px;
}

.cards{
display:flex;
gap:20px;
flex-wrap:wrap;
}

.card{
flex:1;
min-width:220px;
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

.card h3{
margin:0;
color:#555;
}

.card p{
font-size:22px;
font-weight:bold;
}

/* TABLE */
.table-container{
margin-top:30px;
background:white;
padding:20px;
border-radius:10px;
box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:10px;
border-bottom:1px solid #ddd;
}

th{
background:#eef2ff;
}

select{
padding:5px;
border-radius:5px;
}

/* SAVE SECTION */
.save-section{
margin-top:40px;
background:white;
padding:20px;
border-radius:10px;
text-align:center;
box-shadow:0 3px 10px rgba(0,0,0,0.1);
}

.save-btn{
padding:12px 25px;
margin:10px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:bold;
}
.save-btn{
    background:#d32f2f;color:white
}
.green{background:#4caf50;color:white;}
.orange{background:#ff9800;color:white;}

.save-message{
margin-top:10px;
display:none;
padding:10px;
border-radius:6px;
}

</style>
</head>

<body>

<header>
<h2>Admin Dashboard</h2>
<button id="logoutBtn">Logout</button>
</header>

<div class="dashboard">

<div class="cards">
<div class="card">
<h3>Total Bookings</h3>
<p id="totalBookings">0</p>
</div>

<div class="card">
<h3>Total Revenue</h3>
<p id="totalRevenue">₹0</p>
</div>

<div class="card">
<h3>Total Wishlist Items</h3>
<p id="totalWishlist">0</p>
</div>
</div>

<div class="table-container">
<h3>All Bookings</h3>

<table>
<thead>
<tr>
<th>Booking ID</th>
<th>User</th>
<th>Package</th>
<th>Members</th>
<th>Total</th>
<th>Action</th>
<th>Process</th>
</tr>
</thead>

<tbody id="bookingTable"></tbody>

</table>
</div>

<div class="save-section">

<button class="save-btn green" onclick="saveProgress()">
Save Data
</button>

<button class="save-btn orange" onclick="downloadBackup()">
Download Backup
</button>
<button class="save-btn"
onclick="clearBookingsOnly()">
 Clear Bookings
</button>
<div id="saveMessage" class="save-message"></div>

</div>

</div>

<script>

if(localStorage.getItem("adminLoggedIn")!=="true"){
window.location.href="login.html";
}

function loadDashboard(){

const bookings =
JSON.parse(localStorage.getItem("bookingHistory")) || [];

const users =
JSON.parse(localStorage.getItem("users")) || [];

let totalRevenue = 0;
let totalWishlist = 0;

const table =
document.getElementById("bookingTable");

table.innerHTML="";

bookings.forEach((booking,index)=>{

totalRevenue += booking.total || 0;

table.innerHTML += `
<tr>
<td>${booking.bookingId || "-"}</td>
<td>${booking.email || "-"}</td>
<td>${booking.package || "-"}</td>
<td>${booking.members || 0}</td>
<td>₹${booking.total || 0}</td>

<td>
<select onchange="updateAction(${index},this.value)">
<option ${booking.action==="Pending"?"selected":""}>Pending</option>
<option ${booking.action==="Confirmed"?"selected":""}>Confirmed</option>
<option ${booking.action==="Hold"?"selected":""}>Hold</option>
<option ${booking.action==="Cancelled"?"selected":""}>Cancelled</option>
</select>
</td>

<td>
<select onchange="updateProcess(${index},this.value)">
<option ${booking.process==="Booked"?"selected":""}>Booked</option>
<option ${booking.process==="Visa Processing"?"selected":""}>Visa Processing</option>
<option ${booking.process==="Ticket Issued"?"selected":""}>Ticket Issued</option>
<option ${booking.process==="Departed"?"selected":""}>Departed</option>
<option ${booking.process==="Arrived"?"selected":""}>Arrived</option>
<option ${booking.process==="Completed"?"selected":""}>Completed</option>
</select>
</td>
</tr>
`;
});

document.getElementById("totalBookings").innerText =
bookings.length;

document.getElementById("totalRevenue").innerText =
"₹"+totalRevenue;

users.forEach(user=>{
const list =
JSON.parse(localStorage.getItem(
"wishlist_"+user.email
)) || [];

totalWishlist += list.length;
});

document.getElementById("totalWishlist")
.innerText = totalWishlist;
}

function updateAction(index,value){

let bookings =
JSON.parse(localStorage.getItem("bookingHistory")) || [];

bookings[index].action=value;

localStorage.setItem(
"bookingHistory",
JSON.stringify(bookings)
);

loadDashboard();
}

function updateProcess(index,value){

let bookings =
JSON.parse(localStorage.getItem("bookingHistory")) || [];

bookings[index].process=value;

localStorage.setItem(
"bookingHistory",
JSON.stringify(bookings)
);

loadDashboard();
}

function saveProgress(){

const backup={
bookingHistory:
JSON.parse(localStorage.getItem("bookingHistory"))||[],
users:
JSON.parse(localStorage.getItem("users"))||[],
savedAt:new Date().toLocaleString()
};

localStorage.setItem(
"adminBackup",
JSON.stringify(backup)
);

showMessage("✅ Data Saved");
}

function downloadBackup(){

const backup=
localStorage.getItem("adminBackup");

if(!backup){
alert("No backup found");
return;
}

const blob=
new Blob([backup],
{type:"application/json"});

const link=document.createElement("a");

link.href=URL.createObjectURL(blob);
link.download="QuestVoyage_Backup.json";
link.click();

showMessage(" Backup Downloaded");
}

function showMessage(text){

const msg=
document.getElementById("saveMessage");

msg.style.display="block";
msg.style.background="#d4edda";
msg.innerText=text;

setTimeout(()=>{
msg.style.display="none";
},3000);
}

document
.getElementById("logoutBtn")
.addEventListener("click",function(){

localStorage.removeItem("adminLoggedIn");

window.location.href="login.html";

});

function clearBookingsOnly(){

const confirmDelete =
confirm("⚠️ Delete ALL BOOKINGS?\nThis cannot be undone.");

if(!confirmDelete) return;


localStorage.removeItem("bookingHistory");


const users =
JSON.parse(localStorage.getItem("users")) || [];

users.forEach(user=>{
localStorage.removeItem("booking_" + user.email);
});


loadDashboard();

alert("✅ All Bookings Cleared Successfully");

}
loadDashboard();

</script>
<script src='../JS/authcheck.js'></script>

</body>
</html>